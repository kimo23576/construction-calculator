<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة البناء - منصة الاتحاد العام للمقاولين اليمنيين</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: rgba(245, 245, 220, 0.8); /* لون بيج فاتح وشفاف */
        }
        .container {
            max-width: 1200px;
            margin: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd; /* إطار حول الحاسبة */
        }
        h1 {
            text-align: center;
            color: #8B4513; /* اللون البني */
            margin-bottom: 20px;
        }
        h2 {
            color: #A0522D; /* لون بني فاتح */
            margin-top: 30px;
            border-bottom: 2px solid #8B4513; /* خط فاصل تحت العنوان */
            padding-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #8B4513; /* اللون البني */
            color: #fff;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background-color: #A0522D; /* لون بني فاتح */
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 4px;
        }
        .details {
            margin-top: 20px;
        }
        .details h3 {
            color: #16a085;
        }
        .details ul {
            list-style-type: none;
            padding: 0;
        }
        .details li {
            margin-bottom: 10px;
        }
        .export-buttons {
            margin-top: 20px;
        }
        .export-buttons button {
            margin-right: 10px;
        }
        .section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee; /* خط فاصل بين الأقسام */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #8B4513; /* اللون البني */
            color: #fff;
        }
        .total-row {
            font-weight: bold;
            background-color: #f4f4f4;
        }
        .share-buttons {
            margin-top: 20px;
        }
        .share-buttons button {
            margin-right: 10px;
            background-color: #8B4513;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        .share-buttons button:hover {
            background-color: #A0522D;
        }
        .contact-info {
            margin-top: 30px;
            text-align: center;
            color: #888;
        }
        .contact-info a {
            color: #8B4513;
            text-decoration: none;
        }
        .contact-info a:hover {
            text-decoration: underline;
        }
        .manual-price-calculator {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .manual-price-calculator h2 {
            color: #8B4513;
            margin-bottom: 20px;
        }
        .manual-price-calculator p {
            color: #555;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>حاسبة البناء</h1>
        <p style="text-align: center;">منصة الاتحاد العام للمقاولين اليمنيين</p>
        <p style="text-align: center; color: #888;">النتائج تعتمد على الأسعار السائدة للمواد وبنود الأعمال في اليمن، وفق المعايير الدولية وأفضل الممارسات العالمية.</p>

        <!-- إدخال البيانات -->
        <div class="section">
            <h2>إدخال البيانات</h2>
            <label for="projectName">اسم المشروع (اختياري):</label>
            <input type="text" id="projectName" placeholder="أدخل اسم المشروع">

            <label for="buildingType">نوع المبنى:</label>
            <select id="buildingType">
                <option value="residential">سكني (فيلا، شقة، منزل شعبي)</option>
                <option value="commercial">تجاري (محل، مستودع)</option>
                <option value="service">خدمي (مدرسة، مستشفى)</option>
            </select>

            <label for="area">المساحة (م²):</label>
            <input type="number" id="area" placeholder="أدخل المساحة بالمتر المربع">

            <label for="floors">عدد الأدوار:</label>
            <input type="number" id="floors" placeholder="أدخل عدد الأدوار">

            <label for="structureType">نوع الهيكل التصميمي:</label>
            <select id="structureType">
                <option value="concrete">خرسانة مسلحة</option>
                <option value="steel">هيكل حديدي</option>
            </select>

            <label for="constructionPhase">مرحلة البناء:</label>
            <select id="constructionPhase">
                <option value="all">الكل (جميع المراحل)</option>
                <option value="foundation">أساسات</option>
                <option value="structure">عظم</option>
                <option value="finishing">تشطيب</option>
                <option value="electrical">أعمال كهربائية</option>
                <option value="plumbing">أعمال سباكة</option>
                <option value="painting">أعمال دهان</option>
                <option value="tiling">أعمال بلاط</option>
                <option value="doors">أبواب</option>
                <option value="windows">نوافذ</option>
                <option value="flooring">أرضيات</option>
            </select>

            <label for="currency">العملة:</label>
            <select id="currency">
                <option value="YER">الريال اليمني (YER)</option>
                <option value="USD">الدولار الأمريكي (USD)</option>
            </select>

            <label for="exchangeRate">سعر الصرف (إذا كانت العملة دولار):</label>
            <input type="number" id="exchangeRate" placeholder="أدخل سعر الصرف (ريال/دولار)">

            <button onclick="calculateCost()">احسب التكلفة</button>
        </div>

        <!-- النتيجة -->
        <div class="result" id="result">
            <h2>النتيجة</h2>
            <p id="totalCost"></p>
        </div>

        <!-- تفاصيل التكلفة -->
        <div class="details" id="details">
            <h3>تفاصيل التكلفة</h3>
            <ul id="costDetails"></ul>
        </div>

        <!-- جدول الكميات المطلوبة -->
        <div class="section">
            <h2>تقدير الكميات المطلوبة</h2>
            <table id="quantityTable">
                <thead>
                    <tr>
                        <th>المادة</th>
                        <th>الكمية المطلوبة</th>
                        <th>الوحدة</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- سيتم ملء هذا الجدول بالبيانات -->
                </tbody>
            </table>
        </div>

        <!-- تكلفة كل مرحلة -->
        <div class="section">
            <h2>تكلفة كل مرحلة</h2>
            <table id="phaseCostTable">
                <thead>
                    <tr>
                        <th>المرحلة</th>
                        <th>التكلفة</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- سيتم ملء هذا الجدول بالبيانات -->
                </tbody>
            </table>
        </div>

        <!-- حاسبة تكلفة البناء مع تعديل أسعار المواد يدويًا -->
        <div class="manual-price-calculator">
            <h2>حاسبة تكلفة البناء مع تعديل أسعار المواد يدويًا</h2>
            <p>يمكنك في هذا القسم من حساب تكلفة البناء عبر إضافة أسعار المواد الأساسية.</p>
            <table id="manualPriceTable">
                <thead>
                    <tr>
                        <th>المادة</th>
                        <th>الكمية المطلوبة</th>
                        <th>الوحدة</th>
                        <th>السعر (ريال)</th>
                        <th>الإجمالي</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- سيتم ملء هذا الجدول بالبيانات -->
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="4">الإجمالي الكلي</td>
                        <td id="manualTotalCost">0</td>
                    </tr>
                </tfoot>
            </table>
            <button onclick="calculateManualCost()">احسب التكلفة</button>
        </div>

        <!-- دليل أسعار المواد والأعمال -->
        <div class="section">
            <h2>دليل أسعار المواد والأعمال</h2>
            <p>لمعرفة آخر الأسعار المحدثة للمواد والأعمال، يرجى زيارة الرابط التالي:</p>
            <a href="https://guyc-yemen.com/price-guide/" target="_blank">قوائم الأسعار في منصة الاتحاد العام للمقاولين اليمنيين</a>
        </div>

        <!-- مشاركة النتيجة -->
        <div class="share-buttons">
            <button onclick="shareOnWhatsApp()">مشاركة عبر الواتساب</button>
            <button onclick="shareOnFacebook()">مشاركة عبر الفيسبوك</button>
            <button onclick="shareOnTwitter()">مشاركة عبر تويتر</button>
        </div>

        <!-- تفاصيل التواصل -->
        <div class="contact-info">
            <h2>تواصل معنا</h2>
            <p>للمزيد من المعلومات، يرجى زيارة موقعنا الإلكتروني:</p>
            <a href="https://guyc-yemen.com/" target="_blank">الاتحاد العام للمقاولين اليمنيين</a>
        </div>
    </div>

    <script>
        // بيانات الأسعار الافتراضية
        let materialPrices = {
            concrete: 5000, // ريال/م³
            steel: 80000,   // ريال/طن
            cement: 6000,   // ريال/طن
            bricks: 500,    // ريال/1000 طوبة
            paint: 100,     // ريال/لتر
            tiles: 200,     // ريال/م²
            doors: 5000,    // ريال/باب
            windows: 3000,  // ريال/نافذة
            flooring: 150   // ريال/م²
        };

        // جلب أسعار المواد من الرابط
        async function fetchPrices() {
            try {
                const response = await fetch('https://guyc-yemen.com/price-guide/');
                if (!response.ok) {
                    throw new Error("فشل في جلب البيانات من الخادم");
                }
                const data = await response.json();
                if (data.prices) {
                    materialPrices = data.prices; // تحديث الأسعار من الرابط
                }
            } catch (error) {
                console.warn("تعذر جلب الأسعار من الخادم. سيتم استخدام الأسعار الافتراضية.");
            }
        }

        // معايير التكلفة لكل نوع مبنى ومرحلة بناء
        const buildingCosts = {
            residential: {
                foundation: 50000, // ريال/م²
                structure: 150000,
                finishing: 100000,
                electrical: 20000,
                plumbing: 15000,
                painting: 10000,
                tiling: 25000,
                doors: 5000,
                windows: 3000,
                flooring: 15000
            },
            commercial: {
                foundation: 60000,
                structure: 180000,
                finishing: 120000,
                electrical: 25000,
                plumbing: 20000,
                painting: 15000,
                tiling: 30000,
                doors: 6000,
                windows: 4000,
                flooring: 20000
            },
            service: {
                foundation: 70000,
                structure: 200000,
                finishing: 150000,
                electrical: 30000,
                plumbing: 25000,
                painting: 20000,
                tiling: 35000,
                doors: 7000,
                windows: 5000,
                flooring: 25000
            }
        };

        // تقدير الكميات المطلوبة
        function estimateQuantities(area, floors, structureType) {
            const quantities = {
                concrete: (area * 0.2 * floors).toFixed(2), // م³
                steel: (area * 0.05 * floors).toFixed(2),   // طن
                cement: (area * 0.1 * floors).toFixed(2),   // طن
                bricks: (area * 100 * floors).toFixed(2),   // طوبة
                paint: (area * 0.5 * floors).toFixed(2),    // لتر
                tiles: (area * floors).toFixed(2),          // م²
                doors: (area / 10 * floors).toFixed(2),     // باب
                windows: (area / 10 * floors).toFixed(2),   // نافذة
                flooring: (area * floors).toFixed(2)        // م²
            };

            // تعديل الكميات بناءً على نوع الهيكل
            if (structureType === "steel") {
                quantities.concrete = (area * 0.1 * floors).toFixed(2); // تقليل كمية الخرسانة للهيكل الحديدي
                quantities.steel = (area * 0.1 * floors).toFixed(2);   // زيادة كمية الحديد للهيكل الحديدي
            }

            return quantities;
        }

        function calculateCost() {
            const projectName = document.getElementById('projectName').value || "غير محدد";
            const buildingType = document.getElementById('buildingType').value;
            const area = parseFloat(document.getElementById('area').value);
            const floors = parseFloat(document.getElementById('floors').value) || 1;
            const structureType = document.getElementById('structureType').value;
            const constructionPhase = document.getElementById('constructionPhase').value; // مرحلة البناء المحددة
            const currency = document.getElementById('currency').value;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 1;

            if (!area || area <= 0) {
                alert("الرجاء إدخال مساحة صحيحة.");
                return;
            }

            // حساب التكلفة الأساسية لكل مرحلة
            const phaseCosts = {
                foundation: buildingCosts[buildingType].foundation * area * floors,
                structure: buildingCosts[buildingType].structure * area * floors,
                finishing: buildingCosts[buildingType].finishing * area * floors,
                electrical: buildingCosts[buildingType].electrical * area * floors,
                plumbing: buildingCosts[buildingType].plumbing * area * floors,
                painting: buildingCosts[buildingType].painting * area * floors,
                tiling: buildingCosts[buildingType].tiling * area * floors,
                doors: buildingCosts[buildingType].doors * area * floors,
                windows: buildingCosts[buildingType].windows * area * floors,
                flooring: buildingCosts[buildingType].flooring * area * floors
            };

            // تعديل تكلفة الهيكل بناءً على نوع الهيكل
            if (structureType === "steel") {
                phaseCosts.structure = (buildingCosts[buildingType].structure * 1.2) * area * floors; // زيادة تكلفة الهيكل الحديدي بنسبة 20%
            }

            // حساب التكلفة الإجمالية بناءً على المرحلة المحددة
            let totalCost = 0;
            let selectedPhaseCosts = {};

            if (constructionPhase === "all") {
                // إذا تم اختيار "الكل"، يتم حساب تكلفة جميع المراحل
                totalCost = Object.values(phaseCosts).reduce((sum, cost) => sum + cost, 0);
                selectedPhaseCosts = phaseCosts;
            } else {
                // إذا تم اختيار مرحلة محددة، يتم حساب تكلفة تلك المرحلة فقط
                totalCost = phaseCosts[constructionPhase];
                selectedPhaseCosts[constructionPhase] = phaseCosts[constructionPhase];
            }

            // تحويل العملة إذا كانت الدولار
            if (currency === 'USD') {
                totalCost /= exchangeRate;
                for (const phase in selectedPhaseCosts) {
                    selectedPhaseCosts[phase] /= exchangeRate;
                }
            }

            // عرض النتيجة
            document.getElementById('totalCost').innerText = `التكلفة الإجمالية: ${totalCost.toLocaleString()} ${currency}`;

            // عرض تفاصيل التكلفة باللغة العربية
            const phaseNames = {
                foundation: "الأساسات",
                structure: "الهيكل",
                finishing: "التشطيبات",
                electrical: "أعمال كهربائية",
                plumbing: "أعمال سباكة",
                painting: "أعمال دهان",
                tiling: "أعمال بلاط",
                doors: "الأبواب",
                windows: "النوافذ",
                flooring: "الأرضيات"
            };

            const details = Object.keys(selectedPhaseCosts).map(phase => {
                return `<li>${phaseNames[phase]}: ${selectedPhaseCosts[phase].toLocaleString()} ${currency}</li>`;
            }).join("");
            document.getElementById('costDetails').innerHTML = details;

            // تقدير الكميات المطلوبة
            const quantities = estimateQuantities(area, floors, structureType);
            const quantityTable = document.querySelector("#quantityTable tbody");
            quantityTable.innerHTML = `
                <tr><td>الخرسانة</td><td>${quantities.concrete}</td><td>م³</td></tr>
                <tr><td>الحديد</td><td>${quantities.steel}</td><td>طن</td></tr>
                <tr><td>الأسمنت</td><td>${quantities.cement}</td><td>طن</td></tr>
                <tr><td>الطوب</td><td>${quantities.bricks}</td><td>طوبة</td></tr>
                <tr><td>الدهان</td><td>${quantities.paint}</td><td>لتر</td></tr>
                <tr><td>البلاط</td><td>${quantities.tiles}</td><td>م²</td></tr>
                <tr><td>الأبواب</td><td>${quantities.doors}</td><td>باب</td></tr>
                <tr><td>النوافذ</td><td>${quantities.windows}</td><td>نافذة</td></tr>
                <tr><td>الأرضيات</td><td>${quantities.flooring}</td><td>م²</td></tr>
            `;

            // عرض تكلفة كل مرحلة باللغة العربية
            const phaseCostTable = document.querySelector("#phaseCostTable tbody");
            phaseCostTable.innerHTML = Object.keys(selectedPhaseCosts).map(phase => {
                return `<tr><td>${phaseNames[phase]}</td><td>${selectedPhaseCosts[phase].toLocaleString()} ${currency}</td></tr>`;
            }).join("");

            // تحديث جدول الأسعار اليدوية
            updateManualPriceTable(quantities);
        }

        // تحديث جدول الأسعار اليدوية
        function updateManualPriceTable(quantities) {
            const manualPriceTable = document.querySelector("#manualPriceTable tbody");
            manualPriceTable.innerHTML = `
                <tr>
                    <td>الخرسانة</td>
                    <td>${quantities.concrete}</td>
                    <td>م³</td>
                    <td><input type="number" id="manualConcretePrice" placeholder="أدخل السعر"></td>
                    <td id="manualConcreteTotal">0</td>
                </tr>
                <tr>
                    <td>الحديد</td>
                    <td>${quantities.steel}</td>
                    <td>طن</td>
                    <td><input type="number" id="manualSteelPrice" placeholder="أدخل السعر"></td>
                    <td id="manualSteelTotal">0</td>
                </tr>
                <tr>
                    <td>الأسمنت</td>
                    <td>${quantities.cement}</td>
                    <td>طن</td>
                    <td><input type="number" id="manualCementPrice" placeholder="أدخل السعر"></td>
                    <td id="manualCementTotal">0</td>
                </tr>
                <tr>
                    <td>الطوب</td>
                    <td>${quantities.bricks}</td>
                    <td>طوبة</td>
                    <td><input type="number" id="manualBricksPrice" placeholder="أدخل السعر"></td>
                    <td id="manualBricksTotal">0</td>
                </tr>
                <tr>
                    <td>الدهان</td>
                    <td>${quantities.paint}</td>
                    <td>لتر</td>
                    <td><input type="number" id="manualPaintPrice" placeholder="أدخل السعر"></td>
                    <td id="manualPaintTotal">0</td>
                </tr>
                <tr>
                    <td>البلاط</td>
                    <td>${quantities.tiles}</td>
                    <td>م²</td>
                    <td><input type="number" id="manualTilesPrice" placeholder="أدخل السعر"></td>
                    <td id="manualTilesTotal">0</td>
                </tr>
                <tr>
                    <td>الأبواب</td>
                    <td>${quantities.doors}</td>
                    <td>باب</td>
                    <td><input type="number" id="manualDoorsPrice" placeholder="أدخل السعر"></td>
                    <td id="manualDoorsTotal">0</td>
                </tr>
                <tr>
                    <td>النوافذ</td>
                    <td>${quantities.windows}</td>
                    <td>نافذة</td>
                    <td><input type="number" id="manualWindowsPrice" placeholder="أدخل السعر"></td>
                    <td id="manualWindowsTotal">0</td>
                </tr>
                <tr>
                    <td>الأرضيات</td>
                    <td>${quantities.flooring}</td>
                    <td>م²</td>
                    <td><input type="number" id="manualFlooringPrice" placeholder="أدخل السعر"></td>
                    <td id="manualFlooringTotal">0</td>
                </tr>
            `;
        }

        // حساب التكلفة اليدوية
        function calculateManualCost() {
            const quantities = {
                concrete: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(1) td:nth-child(2)").innerText),
                steel: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(2) td:nth-child(2)").innerText),
                cement: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(3) td:nth-child(2)").innerText),
                bricks: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(4) td:nth-child(2)").innerText),
                paint: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(5) td:nth-child(2)").innerText),
                tiles: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(6) td:nth-child(2)").innerText),
                doors: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(7) td:nth-child(2)").innerText),
                windows: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(8) td:nth-child(2)").innerText),
                flooring: parseFloat(document.querySelector("#manualPriceTable tbody tr:nth-child(9) td:nth-child(2)").innerText)
            };

            const prices = {
                concrete: parseFloat(document.getElementById('manualConcretePrice').value) || 0,
                steel: parseFloat(document.getElementById('manualSteelPrice').value) || 0,
                cement: parseFloat(document.getElementById('manualCementPrice').value) || 0,
                bricks: parseFloat(document.getElementById('manualBricksPrice').value) || 0,
                paint: parseFloat(document.getElementById('manualPaintPrice').value) || 0,
                tiles: parseFloat(document.getElementById('manualTilesPrice').value) || 0,
                doors: parseFloat(document.getElementById('manualDoorsPrice').value) || 0,
                windows: parseFloat(document.getElementById('manualWindowsPrice').value) || 0,
                flooring: parseFloat(document.getElementById('manualFlooringPrice').value) || 0
            };

            let totalCost = 0;

            Object.keys(quantities).forEach((material, index) => {
                const total = quantities[material] * prices[material];
                document.querySelector(`#manualPriceTable tbody tr:nth-child(${index + 1}) td:nth-child(5)`).innerText = total.toLocaleString();
                totalCost += total;
            });

            document.getElementById('manualTotalCost').innerText = totalCost.toLocaleString();
        }

        // مشاركة النتيجة عبر الواتساب
        function shareOnWhatsApp() {
            const totalCost = document.getElementById('totalCost').innerText;
            const message = `حاسبة البناء - التكلفة الإجمالية: ${totalCost}\n\n${window.location.href}`;
            const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // مشاركة النتيجة عبر الفيسبوك
        function shareOnFacebook() {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`;
            window.open(url, '_blank');
        }

        // مشاركة النتيجة عبر تويتر
        function shareOnTwitter() {
            const totalCost = document.getElementById('totalCost').innerText;
            const message = `حاسبة البناء - التكلفة الإجمالية: ${totalCost}\n\n${window.location.href}`;
            const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
        }

        // جلب الأسعار عند تحميل الصفحة
        fetchPrices();
    </script>
</body>
</html>